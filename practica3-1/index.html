
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.7">
    
    
      
        <title>Practica_3-1 - jlopgim</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#practica-iaw-31-implantacion-de-moodle-en-amazon-web-services-aws-mediante-ansible" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="jlopgim" class="md-header__button md-logo" aria-label="jlopgim" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            jlopgim
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Practica_3-1
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="jlopgim" class="md-nav__button md-logo" aria-label="jlopgim" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    jlopgim
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Practica_3-1
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Practica_3-1
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#en-esta-practica-vamos-a-realizar-la-implantacion-de-la-aplicacion-web-moodle-en-dos-instancias-ec2-de-amazon-web-services-aws-haciendo-uso-de-playbooks-de-ansible-en-una-de-las-instancias-debera-instalar-apache-http-server-y-los-modulos-necesarios-de-php-y-en-la-otra-maquina-debera-instalar-mysql-server" class="md-nav__link">
    <span class="md-ellipsis">
      En esta práctica vamos a realizar la implantación de la aplicación web Moodle en dos instancias EC2 de Amazon Web Services (AWS) haciendo uso de playbooks de Ansible. En una de las instancias deberá instalar Apache HTTP Server y los módulos necesarios de PHP y en la otra máquina deberá instalar MySQL Server.
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implantacion-de-moodle-en-amazon-web-services-aws-mediante-ansible" class="md-nav__link">
    <span class="md-ellipsis">
      Implantación de Moodle en Amazon Web Services (AWS) mediante Ansible
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pasos-a-seguir-antes-de-todo" class="md-nav__link">
    <span class="md-ellipsis">
      Pasos a seguir antes de todo:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tener-la-siguiente-estructura-de-directorios-y-archivos-dentro-de-la-instancia-del-nodo-control-ya-que-todo-lo-que-vamos-a-hacer-va-a-ser-desde-el-nodo-control" class="md-nav__link">
    <span class="md-ellipsis">
      Tener la siguiente estructura de directorios y archivos dentro de la instancia del nodo control, ya que todo lo que vamos a hacer va a ser desde el nodo control:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#la-arquitectura-de-esta-aplicacion-estara-formada-por-dos-capas" class="md-nav__link">
    <span class="md-ellipsis">
      La arquitectura de esta aplicación estará formada por dos capas:
    </span>
  </a>
  
    <nav class="md-nav" aria-label="La arquitectura de esta aplicación estará formada por dos capas:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#una-capa-de-front-end-formada-por-un-servidor-web-con-apache-http-server" class="md-nav__link">
    <span class="md-ellipsis">
      Una capa de front-end, formada por un servidor web con Apache HTTP Server.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#una-capa-de-back-end-formada-por-un-servidor-mysql" class="md-nav__link">
    <span class="md-ellipsis">
      Una capa de back-end, formada por un servidor MySQL.
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ahora-vamos-al-archivo-de-inventory-donde-en-inventory-tenemos-que-poner-las-ip-publica-del-frontend-y-el-backend-y-el-grupo" class="md-nav__link">
    <span class="md-ellipsis">
      Ahora vamos al archivo de inventory, donde en inventory tenemos que poner las ip pública del frontend y el backend y el grupo.
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-paso-creamos-el-nombre-de-dominio-desde-no-ip-poniendo-la-ip-del-frontend" class="md-nav__link">
    <span class="md-ellipsis">
      1. paso: Creamos el nombre de dominio desde no-ip, poniendo la ip del frontend
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-paso-dentro-de-la-instancia-nodo-control-tener-metida-la-vockeypem-y-darle-permisos-chmod-400-y-descargar-ansible" class="md-nav__link">
    <span class="md-ellipsis">
      2. paso: Dentro de la instancia nodo control, tener metida la vockey.pem y darle permisos chmod 400 y descargar ansible
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-paso-vamos-a-utilizar-las-siguientes-variables" class="md-nav__link">
    <span class="md-ellipsis">
      3. paso: vamos a utilizar las siguientes variables:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-paso-crear-el-archivo-install_lamp_frontendyml" class="md-nav__link">
    <span class="md-ellipsis">
      4. paso: crear el archivo install_lamp_frontend.yml
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-paso-crear-el-archivo-install_lamp_backendyml" class="md-nav__link">
    <span class="md-ellipsis">
      5. paso: crear el archivo install_lamp_backend.yml
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-paso-crear-el-archivo-setup_letsencrypt_httpsyml" class="md-nav__link">
    <span class="md-ellipsis">
      6. paso: crear el archivo setup_letsencrypt_https.yml
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-paso-crear-el-archivo-deployyml" class="md-nav__link">
    <span class="md-ellipsis">
      7. paso: crear el archivo deploy.yml
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-paso-segun-el-orden-hayamos-creado-los-archivos-se-ejecutan-primero-se-ejecuta-el-frontend-backend-letsencrypt-y-por-ultimo-deploy" class="md-nav__link">
    <span class="md-ellipsis">
      8. paso: según el orden hayamos creado los archivos, se ejecutan, primero se ejecuta el frontend, backend, letsencrypt y por ultimo deploy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comprobacion-ejecucion-del-mainyml-donde-se-encuentran-todos-los-archivos" class="md-nav__link">
    <span class="md-ellipsis">
      comprobación ejecucion del main.yml donde se encuentran todos los archivos
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-paso-comprobacion-del-funcionamiento-correcto-de-moodle" class="md-nav__link">
    <span class="md-ellipsis">
      9. paso: comprobación del funcionamiento correcto de moodle
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-paso-comprobar-certificado" class="md-nav__link">
    <span class="md-ellipsis">
      10. paso: comprobar certificado
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#en-esta-practica-vamos-a-realizar-la-implantacion-de-la-aplicacion-web-moodle-en-dos-instancias-ec2-de-amazon-web-services-aws-haciendo-uso-de-playbooks-de-ansible-en-una-de-las-instancias-debera-instalar-apache-http-server-y-los-modulos-necesarios-de-php-y-en-la-otra-maquina-debera-instalar-mysql-server" class="md-nav__link">
    <span class="md-ellipsis">
      En esta práctica vamos a realizar la implantación de la aplicación web Moodle en dos instancias EC2 de Amazon Web Services (AWS) haciendo uso de playbooks de Ansible. En una de las instancias deberá instalar Apache HTTP Server y los módulos necesarios de PHP y en la otra máquina deberá instalar MySQL Server.
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implantacion-de-moodle-en-amazon-web-services-aws-mediante-ansible" class="md-nav__link">
    <span class="md-ellipsis">
      Implantación de Moodle en Amazon Web Services (AWS) mediante Ansible
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pasos-a-seguir-antes-de-todo" class="md-nav__link">
    <span class="md-ellipsis">
      Pasos a seguir antes de todo:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tener-la-siguiente-estructura-de-directorios-y-archivos-dentro-de-la-instancia-del-nodo-control-ya-que-todo-lo-que-vamos-a-hacer-va-a-ser-desde-el-nodo-control" class="md-nav__link">
    <span class="md-ellipsis">
      Tener la siguiente estructura de directorios y archivos dentro de la instancia del nodo control, ya que todo lo que vamos a hacer va a ser desde el nodo control:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#la-arquitectura-de-esta-aplicacion-estara-formada-por-dos-capas" class="md-nav__link">
    <span class="md-ellipsis">
      La arquitectura de esta aplicación estará formada por dos capas:
    </span>
  </a>
  
    <nav class="md-nav" aria-label="La arquitectura de esta aplicación estará formada por dos capas:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#una-capa-de-front-end-formada-por-un-servidor-web-con-apache-http-server" class="md-nav__link">
    <span class="md-ellipsis">
      Una capa de front-end, formada por un servidor web con Apache HTTP Server.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#una-capa-de-back-end-formada-por-un-servidor-mysql" class="md-nav__link">
    <span class="md-ellipsis">
      Una capa de back-end, formada por un servidor MySQL.
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ahora-vamos-al-archivo-de-inventory-donde-en-inventory-tenemos-que-poner-las-ip-publica-del-frontend-y-el-backend-y-el-grupo" class="md-nav__link">
    <span class="md-ellipsis">
      Ahora vamos al archivo de inventory, donde en inventory tenemos que poner las ip pública del frontend y el backend y el grupo.
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-paso-creamos-el-nombre-de-dominio-desde-no-ip-poniendo-la-ip-del-frontend" class="md-nav__link">
    <span class="md-ellipsis">
      1. paso: Creamos el nombre de dominio desde no-ip, poniendo la ip del frontend
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-paso-dentro-de-la-instancia-nodo-control-tener-metida-la-vockeypem-y-darle-permisos-chmod-400-y-descargar-ansible" class="md-nav__link">
    <span class="md-ellipsis">
      2. paso: Dentro de la instancia nodo control, tener metida la vockey.pem y darle permisos chmod 400 y descargar ansible
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-paso-vamos-a-utilizar-las-siguientes-variables" class="md-nav__link">
    <span class="md-ellipsis">
      3. paso: vamos a utilizar las siguientes variables:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-paso-crear-el-archivo-install_lamp_frontendyml" class="md-nav__link">
    <span class="md-ellipsis">
      4. paso: crear el archivo install_lamp_frontend.yml
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-paso-crear-el-archivo-install_lamp_backendyml" class="md-nav__link">
    <span class="md-ellipsis">
      5. paso: crear el archivo install_lamp_backend.yml
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-paso-crear-el-archivo-setup_letsencrypt_httpsyml" class="md-nav__link">
    <span class="md-ellipsis">
      6. paso: crear el archivo setup_letsencrypt_https.yml
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-paso-crear-el-archivo-deployyml" class="md-nav__link">
    <span class="md-ellipsis">
      7. paso: crear el archivo deploy.yml
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-paso-segun-el-orden-hayamos-creado-los-archivos-se-ejecutan-primero-se-ejecuta-el-frontend-backend-letsencrypt-y-por-ultimo-deploy" class="md-nav__link">
    <span class="md-ellipsis">
      8. paso: según el orden hayamos creado los archivos, se ejecutan, primero se ejecuta el frontend, backend, letsencrypt y por ultimo deploy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comprobacion-ejecucion-del-mainyml-donde-se-encuentran-todos-los-archivos" class="md-nav__link">
    <span class="md-ellipsis">
      comprobación ejecucion del main.yml donde se encuentran todos los archivos
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-paso-comprobacion-del-funcionamiento-correcto-de-moodle" class="md-nav__link">
    <span class="md-ellipsis">
      9. paso: comprobación del funcionamiento correcto de moodle
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-paso-comprobar-certificado" class="md-nav__link">
    <span class="md-ellipsis">
      10. paso: comprobar certificado
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="practica-iaw-31-implantacion-de-moodle-en-amazon-web-services-aws-mediante-ansible">Practica-IAW-3.1- Implantación de Moodle en Amazon Web Services (AWS) mediante Ansible</h1>
<h2 id="en-esta-practica-vamos-a-realizar-la-implantacion-de-la-aplicacion-web-moodle-en-dos-instancias-ec2-de-amazon-web-services-aws-haciendo-uso-de-playbooks-de-ansible-en-una-de-las-instancias-debera-instalar-apache-http-server-y-los-modulos-necesarios-de-php-y-en-la-otra-maquina-debera-instalar-mysql-server">En esta práctica vamos a realizar la implantación de la aplicación web Moodle en dos instancias EC2 de Amazon Web Services (AWS) haciendo uso de playbooks de Ansible. En una de las instancias deberá instalar Apache HTTP Server y los módulos necesarios de PHP y en la otra máquina deberá instalar MySQL Server.</h2>
<h2 id="implantacion-de-moodle-en-amazon-web-services-aws-mediante-ansible">Implantación de Moodle en Amazon Web Services (AWS) mediante Ansible</h2>
<h2 id="pasos-a-seguir-antes-de-todo">Pasos a seguir antes de todo:</h2>
<h2 id="tener-la-siguiente-estructura-de-directorios-y-archivos-dentro-de-la-instancia-del-nodo-control-ya-que-todo-lo-que-vamos-a-hacer-va-a-ser-desde-el-nodo-control">Tener la siguiente estructura de directorios y archivos dentro de la instancia del nodo control, ya que todo lo que vamos a hacer va a ser desde el nodo control:</h2>
<p><img alt="" src="../imagenes/estructura.png" /></p>
<h2 id="la-arquitectura-de-esta-aplicacion-estara-formada-por-dos-capas">La arquitectura de esta aplicación estará formada por dos capas:</h2>
<h3 id="una-capa-de-front-end-formada-por-un-servidor-web-con-apache-http-server">Una capa de front-end, formada por un servidor web con Apache HTTP Server.</h3>
<h3 id="una-capa-de-back-end-formada-por-un-servidor-mysql">Una capa de back-end, formada por un servidor MySQL.</h3>
<h2 id="_1"></h2>
<h2 id="ahora-vamos-al-archivo-de-inventory-donde-en-inventory-tenemos-que-poner-las-ip-publica-del-frontend-y-el-backend-y-el-grupo">Ahora vamos al archivo de inventory, donde en inventory tenemos que poner las ip pública del frontend y el backend y el grupo.</h2>
<pre><code class="language-yaml">[frontend]
44.199.2.175

[backend]
34.233.73.87

[all:vars]
ansible_user=ubuntu
ansible_ssh_private_key_file=/home/ubuntu/practica-iaw-3.1/vockey.pem
ansible_ssh_common_args='-o StrictHostKeyChecking=accept-new'
</code></pre>
<h2 id="1-paso-creamos-el-nombre-de-dominio-desde-no-ip-poniendo-la-ip-del-frontend">1. paso: Creamos el nombre de dominio desde no-ip, poniendo la ip del frontend</h2>
<p><img alt="" src="../imagenes/no-ip.png" /></p>
<h2 id="2-paso-dentro-de-la-instancia-nodo-control-tener-metida-la-vockeypem-y-darle-permisos-chmod-400-y-descargar-ansible">2. paso: Dentro de la instancia nodo control, tener metida la vockey.pem y darle permisos chmod 400 y descargar ansible</h2>
<pre><code class="language-yaml">apt install ansible -y
</code></pre>
<h2 id="3-paso-vamos-a-utilizar-las-siguientes-variables">3. paso: vamos a utilizar las siguientes variables:</h2>
<pre><code class="language-yaml">frontend_private_ip: 172.31.41.12

db:
    name: moodle_db
    user: juanje
    password: Eliker123

moodle:
    directory: /var/www/html/moodle
    db_name: moodle_db
    db_user: usuario_moodle
    db_password: Eliker123
    type: mysqli
    db_host: 172.31.34.212
    ip_cliente_mysql: 172.31.%
    domain: practica-iaw.zapto.org
    data_directory: /var/www/moodledata


certbot:
    le_email: juan@email.es
    le_domain: practica-iaw.zapto.org

</code></pre>
<h2 id="4-paso-crear-el-archivo-install_lamp_frontendyml">4. paso: crear el archivo install_lamp_frontend.yml</h2>
<pre><code class="language-yaml">---
- name: Configurar Moodle Frontend
  hosts: frontend
  become: yes

  tasks:

    - name: Actualizar los repositorios
      apt:
        update_cache: yes

    - name: Instalar el servidor web Apache
      apt:
        name: apache2
        state: present

    - name: Instalar PHP y los módulos necesarios
      apt: 
        name:
          - php
          - php-mysql
          - libapache2-mod-php
          - php-bcmath
          - php-curl
          - php-gd
          - php-imagick
          - php-intl
          - php-memcached
          - php-mbstring
          - php-dom
          - php-zip
          - php-cli
          - php-xml
          - php-soap
        state: present

    - name: Modificamos el valor max_input_vars de PHP
      replace: 
        path: /etc/php/8.3/apache2/php.ini
        regexp: ;max_input_vars = 1000
        replace: max_input_vars = 5000

    - name: Modificamos el valor de memory_limit de PHP
      replace: 
        path: /etc/php/8.3/apache2/php.ini
        regexp: memory_limit = 128M
        replace: memory_limit = 256M

    - name: Modificamos el valor de post_max_size de PHP
      replace: 
        path: /etc/php/8.3/apache2/php.ini
        regexp: post_max_size = 8M
        replace: post_max_size = 128M

    - name: Modificamos el valor de upload_max_filesize de PHP
      replace:
        path: /etc/php/8.3/apache2/php.ini
        regexp: upload_max_filesize = 2M
        replace: upload_max_filesize = 128M

    - name: Copiar el archivo de configuración de Apache
      copy:
        src: ../templates/000-default.conf
        dest: /etc/apache2/sites-available/
        mode: 0755

    - name: Crear directorio /var/www/html/moodle
      file:
        path: /var/www/html/moodle
        state: directory
        owner: www-data
        group: www-data
        mode: '0755'

    - name: Crear directorio /var/www/moodledata
      file:
        path: /var/www/moodledata
        state: directory
        owner: www-data
        group: www-data
        mode: '0755'

    - name: Habilitar el módulo rewrite de Apache
      command: a2enmod rewrite
      changed_when: false


    - name: Reiniciar el servidor web Apache
      service:
        name: apache2
        state: restarted
</code></pre>
<h2 id="5-paso-crear-el-archivo-install_lamp_backendyml">5. paso: crear el archivo install_lamp_backend.yml</h2>
<pre><code class="language-yaml">---
- name: Playbook para instalar la pila LAMP en el Backend
  hosts: backend
  become: yes

  vars_files:
    - ../vars/variables.yml

  tasks:

    - name: Actualizar los repositorios
      apt:
        update_cache: yes

    - name: Instalar el sistema gestor de bases de datos MySQL
      apt:
        name: mysql-server
        state: present

    - name: Instalamos el módulo de pymysql
      apt:
        name: python3-pymysql
        state: present

    - name: Crear la base de datos para moodle
      mysql_db:
        name: &quot;{{ moodle.db_name }}&quot;
        encoding: utf8mb4
        collation: utf8mb4_unicode_ci
        state: present
        login_unix_socket: /var/run/mysqld/mysqld.sock

    - name: Borra el usuario si existe
      mysql_user:
        name: &quot;{{ moodle.db_user }}&quot;
        host: &quot;{{ moodle.ip_cliente_mysql }}&quot;
        state: absent
        login_unix_socket: /var/run/mysqld/mysqld.sock

    - name: Crear el usuario para la base de datos de moodle
      mysql_user:
        name: &quot;{{ moodle.db_user }}&quot;
        host: &quot;{{ moodle.ip_cliente_mysql }}&quot;
        password: &quot;{{ moodle.db_password }}&quot;
        priv: &quot;{{ moodle.db_name }}.*:ALL&quot;
        state: present
        login_unix_socket: /var/run/mysqld/mysqld.sock

    - name: Reiniciamos privilegios del usuario
      mysql_db:
        name: &quot;{{ moodle.db_name }}&quot;
        state: present
        login_unix_socket: /var/run/mysqld/mysqld.sock

    - name: Reiniciamos el servicio de base de datos
      service:
        name: mysql
        state: restarted
</code></pre>
<h2 id="6-paso-crear-el-archivo-setup_letsencrypt_httpsyml">6. paso: crear el archivo setup_letsencrypt_https.yml</h2>
<pre><code class="language-yaml">---
- name: Configurar Certbot y solicitar certificado SSL
  hosts: frontend
  become: yes
  vars_files:
    - ../vars/variables.yml 

  tasks:
    # Instalar snapd si no está presente
    - name: Instalar snapd si no está presente
      apt:
        name: snapd
        state: present

    # Instalar el paquete base de snap si no está
    - name: Instalar core de snap si no está presente
      snap:
        name: core
        state: present

    # Eliminar instalaciones anteriores de certbot con apt
    - name: Eliminar Certbot instalado con apt (si existe)
      apt:
        name: certbot
        state: absent

    # Instalar Certbot con snap
    - name: Instalar Certbot usando snap
      snap:
        name: certbot
        state: present

    # Verificar las variables certbot
    - name: Verificar las variables certbot
      debug:
        msg: &quot;Email: {{ certbot.le_email }}, Domain: {{ certbot.le_domain }}&quot;

    # Solicitar un certificado SSL para el dominio con Certbot
    - name: Solicitar certificado SSL para el dominio con Certbot
      command: &gt;
        certbot --apache
        -m &quot;{{ certbot.le_email }}&quot;
        --agree-tos
        --no-eff-email
        -d &quot;{{ certbot.le_domain }}&quot;
        --non-interactive
</code></pre>
<h2 id="7-paso-crear-el-archivo-deployyml">7. paso: crear el archivo deploy.yml</h2>
<pre><code class="language-yaml">- name: Deploy Moodle
  hosts: frontend
  become: yes

  vars_files:
    - ../vars/variables.yml

    - name: Descargar el código fuente de moodle
      get_url:
        url: https://github.com/moodle/moodle/archive/refs/tags/v4.3.1.zip 
        dest: /tmp
        mode: 0755

    - name: Instalar unzip
      apt: 
        name: unzip
        state: present

    - name: Descomprimir el paquete de moodle
      unarchive:
        src: /tmp/moodle-4.3.1.zip  
        dest: /tmp
        remote_src: yes

    - name: Eliminar el directorio de instalación
      file:
        path: /var/www/html/
        state: absent

    - name: Crear el directorio de instalación
      file:
        path: /var/www/html
        state: directory
        owner: www-data
        group: www-data
        mode: 0755

    - name: Copiar contenido de moodle-4.3.1 a /var/www/html
      copy:
        src: /tmp/moodle-4.3.1/
        dest: /var/www/html
        remote_src: true
        force: yes

    - name: Modificar los permisos del directorio /var/www/html
      file:
        path: /var/www/html
        owner: www-data
        group: www-data
        recurse: yes
        mode: 0755

    - name: Modificar los permisos del directorio /var/moodledata
      file:
        path: /var/moodledata
        owner: www-data
        group: www-data
        recurse: yes
        mode: 0755

    - name: Instalar moodle desde PHP CLI
      command:
        sudo -u www-data php /var/www/html/admin/cli/install.php \
        --wwwroot={{ moodle.www_root }} \
        --dataroot={{ moodle.data_root }} \
        --dbtype={{ moodle.type }} \
        --dbhost={{ moodle.host }} \
        --dbname={{ db.name }} \
        --dbuser={{ db.user }} \
        --dbpass={{ db.password }} \
        --fullname=&quot;{{ moodle.fullname }}&quot; \
        --shortname=&quot;{{ moodle.shortname }}&quot; \
        --summary=&quot;{{ moodle.summary }}&quot; \
        --adminuser={{ moodle.admin_user }} \
        --adminpass={{ moodle.admin_pass }} \
        --adminemail={{ moodle.admin_email }} \
        --non-interactive \
        --agree-license
      args:
        chdir: /var/www/html

    - name: Configurar cron para Moodle
      become: yes
      ansible.builtin.cron:
        name: &quot;Moodle Cron Job&quot;
        minute: &quot;*&quot;
        job: &quot;/usr/bin/php /var/www/html/admin/cli/cron.php &gt;/dev/null 2&gt;&amp;1&quot;
        state: present


    - name: Reiniciar servicio cron 
      become: yes
      ansible.builtin.service:
        name: cron
        state: restarted
        enabled: yes

</code></pre>
<h2 id="8-paso-segun-el-orden-hayamos-creado-los-archivos-se-ejecutan-primero-se-ejecuta-el-frontend-backend-letsencrypt-y-por-ultimo-deploy">8. paso: según el orden hayamos creado los archivos, se ejecutan, primero se ejecuta el frontend, backend, letsencrypt y por ultimo deploy</h2>
<pre><code class="language-yaml">sudo ansible-playbook -i ./inventory/inventory main.yml
</code></pre>
<h2 id="comprobacion-ejecucion-del-mainyml-donde-se-encuentran-todos-los-archivos">comprobación ejecucion del main.yml donde se encuentran todos los archivos</h2>
<p><img alt="" src="../imagenes/ejecuion.png" /></p>
<h2 id="9-paso-comprobacion-del-funcionamiento-correcto-de-moodle">9. paso: comprobación del funcionamiento correcto de moodle</h2>
<p><img alt="" src="../imagenes/moodle.PNG" /></p>
<h2 id="10-paso-comprobar-certificado">10. paso: comprobar certificado</h2>
<p><img alt="" src="../imagenes/certificado.png" /></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>